

// for microProbe
	#define TICKS_PER_SECOND (10000u)

// math constants
	#define PI32 4.7123890f			// 3/2*PI
	#define K23 0.66666667f			// 2/3
	#define Ksqr32 0.86602540f		// sqrt(3)/2
	#define K23sqr3 0.38490018f		// sqrt(3)/2

// system constants
	#define fs 10000.000f
	#define Ts 0.00010000f
	#define wL 0.78539816f			// =100*pi*(1.25e-3*2)
	#define Kp_I 1.9300000f
	#define Ki_I 174.00000f
	#define kd 0.00100000f
	#define td 0.06600000f

// conversion constants
	#define ADCconv 0.00080586f		// =value* 3.3/4095 uint to real voltage
	#define ADCoffset 1.6500000f	// =value* 3.3/2
	#define ADC2V 229.772f			// =value* 2/(15/230*536/(536+3480))
	// #define ADC2Vdc 0.0709f		// =value* 220/2.5*3.3/4096
	// #define ADC2Vdc 0.0716f		// =value* 222/2.475*3.3/4096
	// #define ADC2Vdc 0.0363f		// =value* 101.5/2.25*3.3/4096
	#define ADC2Vdc 0.247897f		// =value* 980/3.185*3.3/4096
	#define ADC2I 32.2581f			// =value* 50/(3.2/2)

// filter constants
	#define wo_LPF_15 94.2478f		// LPF cutoff frequency- 15 Hz
	#define wo_LPF_50 314.159f		// LPF cutoff frequency- 50 Hz
	#define wo_LPF_100 628.319f		// LPF cutoff frequency- 100 Hz
	#define wo_LPF_500 3769.91f		// LPF cutoff frequency- 550 Hz (3455.75f)
	#define wo_LPF_Iref 314.15927f	// LPF cutoff frequency- 50 Hz
	#define DCV_low 30.0000f		// DC voltage low limit
	#define DCV_high 500.000f		// DC voltage high limit
	
	const float PI_K_PLL[2]={1.0f, 100.0f};
	const float K_sync[4]={11000.0f, 0.97f, 30.0f};
	const float PI_K_CC[2]={Kp_I, Kp_I*Ki_I*Ts-Kp_I};
	const float HPF_K[4]={kd*td, -kd*td, td, td-Ts};
	const float LPF_K_15[3]={1, Ts*wo_LPF_15/(2+Ts*wo_LPF_15), -(Ts*wo_LPF_15-2)/(2+Ts*wo_LPF_15)};
	const float LPF_K_50[3]={1, Ts*wo_LPF_50/(2+Ts*wo_LPF_50), -(Ts*wo_LPF_50-2)/(2+Ts*wo_LPF_50)};
	const float LPF_K_100[3]={1, Ts*wo_LPF_100/(2+Ts*wo_LPF_100), -(Ts*wo_LPF_100-2)/(2+Ts*wo_LPF_100)};
	const float LPF_K_500[3]={1, Ts*wo_LPF_500/(2+Ts*wo_LPF_500), -(Ts*wo_LPF_500-2)/(2+Ts*wo_LPF_500)};
	const float LPF_K_Iref[3]={1, Ts*wo_LPF_Iref/(2+Ts*wo_LPF_Iref), -(Ts*wo_LPF_Iref-2)/(2+Ts*wo_LPF_Iref)};
	
// global vaiables initialization
	// References
	float V_dq_ref[2]={16.2500f, 0.0f};
	
	// State variables
	uint32_t m_abc[3]={0u, 0u, 0u};		// Modulation signal to the PWM
	uint16_t state=0u;					// Program flow state variable
	uint16_t sync=0u;					// PLL synchronization flag
	uint16_t sync_aux3=0u;				// PLL stability auxiliary variable
	uint16_t V_DC_adc=0u;				// ADC DC bus voltage
	uint16_t V_abc_adc[3]={0u, 0u, 0u};	// ADC voltage measurements
	uint16_t I_abc_adc[3]={0u, 0u, 0u};	// ADC current measurements
	float V_DC=0.0f;					// DC bus voltage
	float V_abc[3]={0.0f, 0.0f, 0.0f};	// AC voltages
	float I_abc[3]={0.0f, 0.0f, 0.0f};	// AC currents
	float V_AB[2]={0.0f, 0.0f};			// alpha beta voltage
	float I_AB[2]={0.0f, 0.0f};			// alpha beta current
	float V_DCf=0.0f;					// DC bus voltage filtered
	float V_ABf[2]={0.0f, 0.0f};		// alpha beta filtered voltage
	float I_ABf[2]={0.0f, 0.0f};		// alpha beta filtered current
	float V_dq[2]={0.0f, 0.0f};			// dq voltage
	float I_dq[2]={0.0f, 0.0f};			// dq current
	float I_dq_ref[2]={0.0f, 0.0f};		// dq current references
	float I_dq_ref_f[2]={0.0f, 0.0f};	// dq filtered current references
	float Ie_dq[2]={0.0f, 0.0f};		// dq current error
	float ID_dq[2]={0.0f, 0.0f};			// dq current error derivative
	float Vm_abc[3]={0.0f, 0.0f, 0.0f};	// Modulation voltages
	float Vm_AB[2]={0.0f, 0.0f};		// Modulation alpha beta voltage
	float Vm_dq[2]={0.0f, 0.0f};		// Modulation dq voltage
	float Vm_AB2=0.0f;					// alpha beta squared: A^2+B^2
	float ma_max=0.950000f;				// Maximum modulation index
	float w=0.0f;						// PLL frequency
	float dw=0.0f;						// PLL frequency rate
	float wf=0.0f;						// filtered PLL frequency
	float wt=0.0f;						// PLL angle
	float sync_aux2=0.0f;
	
	// Buffer variables
	float PI_PLL_buff[3]={0.0f, 0.0f, 0.0f}; 	// PLL PI buffer
	float PI_CCd_buff[2]={0.0f, 0.0f};			// PI current control buffer
	float PI_CCq_buff[2]={0.0f, 0.0f};
	float HPFd_buff[2]={0.0f, 0.0f};
	float HPFq_buff[2]={0.0f, 0.0f};
	float dw_buff=0.0f;
	float wt_buff=0.0f;
	uint16_t sync_aux3_buff=0u;
	float LPF_buff_w[2]={0.0f, 0.0f};
	float LPF_buff_sync2[2]={0.0f, 0.0f};
	float LPF_buff_VA[2]={0.0f,0.0f}, LPF_buff_VB[2]={0.0f,0.0f};
	float LPF_buff_IA[2]={0.0f,0.0f}, LPF_buff_IB[2]={0.0f,0.0f};
	float LPF_buff_Irefd[2]={0.0f,0.0f}, LPF_buff_Irefq[2]={0.0f,0.0f};
	float LPF_buff_Vdc[2]={0.0f,0.0f};
